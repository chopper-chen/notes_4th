{"root":{"data":{"id":"eccf1fbbcd90","created":1595385366,"text":"美好的源码之旅","expandState":"expand"},"children":[{"data":{"id":"c4csx34sico0","created":1595385383262,"text":"自定义视图类继承APIView类","expandState":"expand","layout":null},"children":[{"data":{"id":"c4csynunez40","created":1595385506725,"text":"APIView类类的as_view()方法主要做了两件事","expandState":"expand","layout":null},"children":[{"data":{"id":"c4csynunfjc0","created":1595385506725,"text":"1.调用父类View的as_view()方法","expandState":"collapse","layout":null},"children":[{"data":{"id":"c4csynunvlc0","created":1595385506726,"text":"View的as_view()方法的内置view方法调用dispatch方法并返回，实现根据请求方法去调用不同的视图函数，即dispatch请求分发","layout":null},"children":[{"data":{"id":"c4csynunsvc0","created":1595385506726,"text":"dispatch方法：","layout":null},"children":[{"data":{"id":"c4csynunsf40","created":1595385506726,"text":"先把http方法改为小写，然后判断该方法是否在与已定义的http_method_names列表中，若请求方法存在，就在自定义的类视图中获取到该方法（用getattr方法），然后返回","layout":null},"children":[]},{"data":{"id":"c4csynunuw80","created":1595385506726,"text":"此处调用的dispatch方法，并非view类的，而是apiview类的","layout":null},"children":[]}]}]}]},{"data":{"id":"c4csynunxow0","created":1595385506726,"text":"2. 禁用csrftoken","layout":null},"children":[]}]},{"data":{"id":"c4csynunyag0","created":1595385506726,"text":"类方法或类属性调用顺序","expandState":"expand","layout":null},"children":[{"data":{"id":"c4csynuoibc0","created":1595385506727,"text":"1，先在当前类中找，找到后调用","layout":null},"children":[]},{"data":{"id":"c4csynuoac80","created":1595385506727,"text":"2、若当前类找不到，则去父类找，找到后调用","layout":null},"children":[]},{"data":{"id":"c4csynuohyw0","created":1595385506727,"text":"3、若父类找不到，则去父类的父类找，以此类推","layout":null},"children":[]}]}]},{"data":{"id":"c4csx448hgg0","created":1595385385405,"text":"view继承关系","expandState":"expand","layout":null},"children":[{"data":{"id":"c4ctpuvqsq80","created":1595387637861,"text":"","image":"https://kityminder-img.gz.bcebos.com/e7a8b390d43cabdeb1a652b162adb5004f7fda59","imageSize":{"width":200,"height":139},"expandState":"expand","layout":null},"children":[]}]},{"data":{"id":"c4csx4v2sxs0","created":1595385387028,"text":"APIView比View强大在哪里","expandState":"expand","layout":null},"children":[{"data":{"id":"c4cufrb4j480","created":1595389667553,"text":"1、传入到视图方法中的是Request对象，而不是Django中的HTTPRequest对象","expandState":"expand","layout":null},"children":[{"data":{"id":"c4cuksstf4o0","created":1595390062620,"text":"实例化Request：request = self.initialize_request(request, *args, **kwargs)","layout":null},"children":[{"data":{"id":"c4cut96rhgg0","created":1595390725205,"text":" ","image":"https://kityminder-img.gz.bcebos.com/a6f28a490eebcce6d637c5da4204f98841b3093b","imageSize":{"width":200,"height":94},"layout":null},"children":[]},{"data":{"id":"c4cutqnvcao0","created":1595390763245,"text":"Request(\n\trequest,\n\tparsers=self.get_parsers(),\n\tauthenticators=self.get_authenticators(),\n\tnegotiator=self.get_content_negotiator(),\n\tparser_context=parser_context\n)","layout":null},"children":[{"data":{"id":"c4cuu6vh19s0","created":1595390798533,"text":"读取配置，传入Request，完善成自己的request对象","layout":null},"children":[]},{"data":{"id":"c4cuuu7eh7c0","created":1595390849320,"text":"Request类的__init__()方法","layout":null},"children":[{"data":{"id":"c4cuv74r8t40","created":1595390877458,"text":"self._request = request\n拷贝Django原生的request对象，换个名字_request保存\n如果需要使用Django原生的request，可以调用_request属性","layout":null},"children":[]},{"data":{"id":"c4cuwj6i8i00","created":1595390982050,"text":"self.parsers = parsers or ()\nself.authenticators = authenticators or ()\nself.negotiator = negotiator or self._default_negotiator()\nself.parser_context = parser_context","layout":null},"children":[{"data":{"id":"c4cuwkmvuc80","created":1595390985217,"text":"根据传入的参数设置request的属性，有传则替换，没传则保留原有或置空","layout":null},"children":[]}]},{"data":{"id":"c4cuxenahow0","created":1595391050545,"text":"self._data = Empty\nself._files = Empty\nself._full_data = Empty\nself._content_type = Empty\nself._stream = Empty","layout":null},"children":[{"data":{"id":"c4cuxldv0kw0","created":1595391065212,"text":"定义属性，值为一个Empty空类"},"children":[]},{"data":{"id":"c4cuy6jwfls0","created":1595391111290,"text":"好处1：判断的时候不易出错"},"children":[]},{"data":{"id":"c4cuydfbgog0","created":1595391126250,"text":"好处2：可扩展性强"},"children":[]},{"data":{"id":"c4cuyhzk2jk0","created":1595391136181,"text":"好处3：操作性更强，可动态添加属性"},"children":[]}]}]}]}]},{"data":{"id":"c4culvdda7s0","created":1595390146580,"text":" ","image":"https://kityminder-img.gz.bcebos.com/627cdea4af89c6518a8d66f474ec0c411a0621bf","imageSize":{"width":200,"height":144},"layout":null},"children":[]}]},{"data":{"id":"c4cug80nocg0","created":1595389703925,"text":"2、视图方法可以返回Response对象，会为响应数据处理（render）为符合前端要求的格式","expandState":"expand","layout":null},"children":[{"data":{"id":"c4curv31xsw0","created":1595390616142,"text":"self.response = self.finalize_response(request, response, *args, **kwargs)","expandState":"collapse","layout":null},"children":[{"data":{"id":"c4cusfpdp2o0","created":1595390661027,"text":"","image":"https://kityminder-img.gz.bcebos.com/617c978ba7e53b0def14d780469231a2408614b4","imageSize":{"width":200,"height":165},"layout":null},"children":[]}]},{"data":{"id":"c4curvo9r2o0","created":1595390617424,"text":"","image":"https://kityminder-img.gz.bcebos.com/5a76b6d0a7ab0dccae7664cbf4232fc72fdc67ef","imageSize":{"width":200,"height":144},"layout":null},"children":[]}]},{"data":{"id":"c4cugseehyg0","created":1595389748292,"text":"3、任何APIException异常都会被捕获到，并且处理成合适的响应信息","expandState":"expand","layout":null},"children":[{"data":{"id":"c4cuqvhy6uw0","created":1595390538678,"text":"try：\nexcept Exception as exc:","layout":null},"children":[]},{"data":{"id":"c4cuqws4d140","created":1595390541470,"text":"","image":"https://kityminder-img.gz.bcebos.com/803cbf7bc7104df0947f48c94ee3394735f53f67","imageSize":{"width":200,"height":139},"layout":null},"children":[]}]},{"data":{"id":"c4cuh9tx66o0","created":1595389786235,"text":"4、在进行dispatch()分发前，会对请求进行身份认证、权限检查、流量控制","expandState":"expand","layout":null},"children":[{"data":{"id":"c4cumzck5e80","created":1595390233603,"text":"self.initial(request, *args, **kwargs)","expandState":"collapse","layout":null},"children":[{"data":{"id":"c4cunf3h6eg0","created":1595390267882,"text":"self.perform_authentication(request)","layout":null},"children":[{"data":{"id":"c4cupgu4eow0","created":1595390428398,"text":" ","image":"https://kityminder-img.gz.bcebos.com/d82f89679e029555898d3544b6d00c9c6567b901","imageSize":{"width":200,"height":53},"layout":null},"children":[]}]},{"data":{"id":"c4cunf3h2iw0","created":1595390267882,"text":"self.check_permissions(request)","layout":null},"children":[{"data":{"id":"c4cupofxcmg0","created":1595390444954,"text":" ","image":"https://kityminder-img.gz.bcebos.com/413bd5139d9c31b2aa431c07c772b9d6880c3226","imageSize":{"width":200,"height":61},"layout":null},"children":[]}]},{"data":{"id":"c4cunf3haz40","created":1595390267882,"text":"self.check_throttles(request)","layout":null},"children":[{"data":{"id":"c4cupw5k1280","created":1595390461741,"text":" ","image":"https://kityminder-img.gz.bcebos.com/3483be080b3272ef1a335b68444b31d78218e064","imageSize":{"width":200,"height":109},"layout":null},"children":[]}]},{"data":{"id":"c4cunrdcbeg0","created":1595390294600,"text":" ","image":"https://kityminder-img.gz.bcebos.com/f1ef5b5bbd8872f754f244d5552ae3ee1186f590","imageSize":{"width":200,"height":95},"layout":null},"children":[]}]},{"data":{"id":"c4cuoc4g7js0","created":1595390339775,"text":" ","image":"https://kityminder-img.gz.bcebos.com/40179b0805ca248a3666e5bc48fcace749fd6155","imageSize":{"width":200,"height":147},"layout":null},"children":[]}]}]},{"data":{"id":"c4csx66p5c80","created":1595385389908,"text":"Question","expandState":"expand","layout":null},"children":[{"data":{"id":"c4cuicttltk0","created":1595389871124,"text":"自定义了一个视图类①，继承自View","expandState":"expand","layout":null},"children":[{"data":{"id":"c4cuiulqeyo0","created":1595389909817,"text":"分发请求走的是View的dispatch","layout":null},"children":[]}]},{"data":{"id":"c4cuilsoipc0","created":1595389890646,"text":"自定义了一个视图类②，继承自APIView","expandState":"expand","layout":null},"children":[{"data":{"id":"c4cuj1d9utc0","created":1595389924543,"text":"分发请求走的是APIView的dispatch","layout":null},"children":[]}]},{"data":{"id":"c4cujg2yu9s0","created":1595389956571,"text":"APIView和View请求周期中，最重要的函数是dispatch","expandState":"expand","layout":null},"children":[]}]},{"data":{"id":"c4csx6shx7c0","created":1595385391226,"text":"Request对象几个重点方法","expandState":"expand","layout":null},"children":[{"data":{"id":"c4cuzu2o7w00","created":1595391240855,"text":"query_params"},"children":[{"data":{"id":"c4cv0b0f08o0","created":1595391277724,"text":"对Django原生的request对象的GET方法取别名"},"children":[]},{"data":{"id":"c4cv0mex0zs0","created":1595391302545,"text":"","image":"https://kityminder-img.gz.bcebos.com/7af15b21e082026bc2540aedc9bd687157c9e15a","imageSize":{"width":200,"height":51}},"children":[]}]},{"data":{"id":"c4cv00ir30o0","created":1595391254888,"text":"data"},"children":[{"data":{"id":"c4cv0tad94o0","created":1595391317508,"text":"","image":"https://kityminder-img.gz.bcebos.com/5d5abf20a1c19954c4f8ce1a91e7a59e5383b25b","imageSize":{"width":200,"height":58}},"children":[{"data":{"id":"c4cv14r4cu00","created":1595391342465,"text":"","image":"https://kityminder-img.gz.bcebos.com/8d26120dbbcff34a3ae58d4ef411eee7424da3ae","imageSize":{"width":200,"height":96}},"children":[]}]},{"data":{"id":"c4cv178agyo0","created":1595391347857,"text":"合并Django原生request对象的POST和FILES方法"},"children":[]}]}]}]},"template":"default","theme":"fresh-blue","version":"1.4.43"}